"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(){var e="lamponline_server_url",t="lamponline_servers",a="lamponline_active_server",n="lamponline_server_countries",i="lamponline_server_tokens",o="rc.bwa.to";function r(){var a=Lampa.Storage.get(t,[]);if("string"==typeof a)try{a=JSON.parse(a)}catch(e){a=[]}Lampa.Arrays.isArray(a)||(a=[]);var n=Lampa.Storage.get(e,"");return n&&-1===a.indexOf(n)&&(a.push(n),Lampa.Storage.set(t,a)),a}function l(){var e=r(),t=parseInt(Lampa.Storage.get(a,0))||0;return t>=e.length&&(t=0),t}function s(e){Lampa.Storage.set(a,e)}function c(e){if(!e)return!1;var a=r();return-1===a.indexOf(e)&&(a.push(e),Lampa.Storage.set(t,a),!0)}function m(a){var n=r();if(a>=0&&a<n.length){var i=n[a];return n.splice(a,1),Lampa.Storage.set(t,n),Lampa.Storage.get(e,"")===i&&Lampa.Storage.set(e,""),l()>=n.length&&s(Math.max(0,n.length-1)),!0}return!1}function p(){var e=Lampa.Storage.get(n,{});if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}return e||{}}function d(){var e=r();if(0===e.length)return"";var t=e[l()]||"";if(h(t))return"";var a=t;return a&&0!==(a=a.replace(/\/+$/,"")).indexOf("http://")&&0!==a.indexOf("https://")&&(a="http://"+a),a}function u(){return Boolean(d())||f()}function v(){var e=r()[l()]||"";return 0===e.toLowerCase().indexOf("bwa::")?e.substring(5):""}function f(){return 0===(r()[l()]||"").toLowerCase().indexOf("bwa::")}function h(e){return e&&0===e.toLowerCase().indexOf("bwa::")}function g(e){if(h(e)){var t=h(a=e)?a.substring(5):"";return t&&t.length>2?"BWA: "+t.substring(0,2)+"****":t?"BWA: "+t:"BWA"}var a,n=e.replace(/^https?:\/\//,""),i=function(e){if(!e)return"";var t=e.replace(/^https?:\/\//,"").replace(/\/+$/,"").toLowerCase();return p()[t]||""}(e);return i?n+" ("+i+")":n}function _(){var e=Lampa.Storage.get(i,"{}");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}return e||{}}function L(e){return _()[e]||""}function y(e,t){var a=_();t?a[e]=t:delete a[e],Lampa.Storage.set(i,a)}var w=o,b=!1;function k(e){var t=v();if(t)if(b)e&&e(!0);else{var a="http://"+o+"/online/js/"+t;Lampa.Utils.putScriptAsync([a],(function(){b=!0,e&&e(!0)}))}else e&&e(!1)}var x,C,S={getHostKey:function(){return(e=d())?e.replace(/^https?:\/\//,""):"";var e},Urls:{getLocalhost:function(){var e=d();return e?e+"/":""},getLampOnline:function(){return d()},NwsClientScript:"https://ipavlin98.github.io/lmp-plugins/nws-client-es5.js",GithubCheck:"https://github.com/",CorsCheckPath:"/cors/check"},Rch:{RegistryVersion:149,ClientTimeout:8e3},StorageKeys:{LampacUnicId:"lampac_unic_id",LampacProfileId:"lampac_profile_id",ClarificationSearch:"clarification_search",OnlineLastBalanser:"online_last_balanser",OnlineBalanser:"online_balanser",ActiveBalanser:"active_balanser",OnlineChoicePrefix:"online_choice_",OnlineWatchedLast:"online_watched_last",OnlineView:"online_view"}},T={getLocalhost:function(){return f()?"http://"+o+"/":S.Urls.getLocalhost()}};function A(){return void 0!==x?P.resolve(Lampa.Arrays.isArray(x)?x:[]):u()?C||(C=new P((function(e){var t=new Lampa.Reguest;t.timeout(1e4),t.silent(F(T.getLocalhost()+"lite/withsearch"),(function(t){x=Lampa.Arrays.isArray(t)?t:[],e(x)}),(function(t){console.error(t),e(x=[])}))}))):P.resolve([])}function z(){return f()?o:S.getHostKey()}function O(){var e=z();return e?(window.rch_nws[e]||(window.rch_nws[e]={type:Lampa.Platform.is("android")?"apk":Lampa.Platform.is("tizen")?"cors":void 0,startTypeInvoke:!1,rchRegistry:!1,apkVersion:0}),window.rch_nws[e]):null}window.rch_nws||(window.rch_nws={}),O();var U=z();"function"!=typeof(window.rch_nws[U]&&window.rch_nws[U].typeInvoke)&&((q=U)&&window.rch_nws[q]&&(window.rch_nws[q].typeInvoke=function(e,t){var a=z();if(window.rch_nws[a].startTypeInvoke)t();else{window.rch_nws[a].startTypeInvoke=!0;var n=function(e){window.rch_nws[a].type=Lampa.Platform.is("android")?"apk":e?"cors":"web",t()};if(Lampa.Platform.is("android")||Lampa.Platform.is("tizen"))n(!0);else(new Lampa.Reguest).silent(S.Urls.getLampOnline().indexOf(location.host)>=0?S.Urls.GithubCheck:e+S.Urls.CorsCheckPath,(function(){n(!0)}),(function(){n(!1)}),!1,{dataType:"text"})}}));var q,N=z();"function"!=typeof(window.rch_nws[N]&&window.rch_nws[N].Registry)&&((q=N)&&window.rch_nws[q]&&(window.rch_nws[q].Registry=function(e,t){var a=z();new P((function(e){window.rch_nws[a].typeInvoke(S.Urls.getLampOnline(),e)})).then((function(){e.invoke("RchRegistry",JSON.stringify({version:S.Rch.RegistryVersion,host:location.host,rchtype:Lampa.Platform.is("android")?"apk":Lampa.Platform.is("tizen")?"cors":window.rch_nws[a].type,apkVersion:window.rch_nws[a].apkVersion,player:Lampa.Storage.field("player")})),e._shouldReconnect&&window.rch_nws[a].rchRegistry?t&&t():(window.rch_nws[a].rchRegistry=!0,e.on("RchRegistry",(function(e){t&&t()})),e.on("RchClient",(function(t,a,n,i,o){var r=new Lampa.Reguest;function l(a){(Lampa.Arrays.isObject(a)||Lampa.Arrays.isArray(a))&&(a=JSON.stringify(a)),e.invoke("RchResult",t,a)}"eval"==a?l(""):"ping"==a?l("pong"):r.native(a,l,(function(){l("")}),n,{dataType:"text",timeout:S.Rch.ClientTimeout,headers:i,returnHeaders:o})})),e.on("Connected",(function(e){window.rch_nws[a].connectionId=e})))})).catch((function(e){console.error(e),t&&t()}))}));z()&&window.rch_nws[z()].typeInvoke(S.Urls.getLampOnline(),(function(){}));var R=null,B=!1,P=function(){if(void 0!==window.Promise)return window.Promise;function e(t){var a=0,n=null,i=[];function o(){setTimeout((function(){for(var e=0;e<i.length;e++)l(i[e]);i=[]}),0)}function r(e){a=2,n=e,o()}function l(e){if(0!==a){var t=1===a?e.onFulfilled:e.onRejected;if(t)try{e.resolve(t(n))}catch(t){e.reject(t)}else(1===a?e.resolve:e.reject)(n)}else i.push(e)}this.then=function(t,a){return new e((function(e,n){l({onFulfilled:"function"==typeof t?t:null,onRejected:"function"==typeof a?a:null,resolve:e,reject:n})}))},this.catch=function(e){return this.then(null,e)};var s=this;try{t((function e(t){try{if(t===s)throw new TypeError("Promise resolved with itself");if(t&&("object"===_typeof(t)||"function"==typeof t)){var i=t.then;if("function"==typeof i)return i.call(t,e,r)}a=1,n=t,o()}catch(e){r(e)}}),r)}catch(e){r(e)}}return e.resolve=function(t){return new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,a){a(t)}))},e}(),I=function(){var e;function t(){var e=z();return e&&window.nwsClient&&window.nwsClient[e]?window.nwsClient[e]:null}return{connect:function(a){return("undefined"!=typeof NativeWsClient?P.resolve():e||(e=new P((function(e){Lampa.Utils.putScript([S.Urls.NwsClientScript],(function(){}),!1,e,!0)})))).then((function(){return new P((function(e,n){try{var i=z();if(!i)return n(new Error("Server not configured"));if(O(),window.nwsClient&&window.nwsClient[i]&&window.nwsClient[i]._shouldReconnect)return e(t());window.nwsClient||(window.nwsClient={}),window.nwsClient[i]&&window.nwsClient[i].socket&&window.nwsClient[i].socket.close(),window.nwsClient[i]=new NativeWsClient(a.nws,{autoReconnect:!1}),window.nwsClient[i].on("Connected",(function(a){window.rch_nws[i].Registry(window.nwsClient[i],(function(){e(t())}))})),window.nwsClient[i].connect()}catch(e){console.error(e),n(e)}}))}))},send:function(){var e=t();e&&e.invoke&&e.invoke.apply(e,arguments)},onMessage:function(e,a){var n=t();n&&n.on&&n.on(e,a)},getClient:t}}();function E(e,t){I.connect(e).then((function(){t()})).catch((function(e){console.error(e)}))}function j(e,t){if(e+="",t&&t.length&&(e=e+(e.indexOf("?")>=0?"&":"?")+t.join("&")),-1==e.indexOf("uid=")){var a=Lampa.Storage.get("lampac_unic_id","")||"guest";e=Lampa.Utils.addUrlComponent(e,"uid="+encodeURIComponent(a))}if(f()){if(-1==e.indexOf("account_email=")){var n=Lampa.Storage.get("account_email","");n&&(e=Lampa.Utils.addUrlComponent(e,"account_email="+encodeURIComponent(n)))}if(-1==e.indexOf("token=")){var i=v();i&&(e=Lampa.Utils.addUrlComponent(e,"token="+encodeURIComponent(i)))}if(-1==e.indexOf("nws_id=")&&window.rch_nws&&window.rch_nws[w]){var o=window.rch_nws[w].connectionId||"";o&&(e=Lampa.Utils.addUrlComponent(e,"nws_id="+encodeURIComponent(o)))}if(-1==e.indexOf("rchtype=")){var s=window.rch_nws&&window.rch_nws[w]&&window.rch_nws[w].type||"web";e=Lampa.Utils.addUrlComponent(e,"rchtype="+s)}}else{var c=d()?L(r()[l()]||""):"";if(c){var m=c.split("=")[0];m&&-1==e.indexOf(m+"=")&&(e=Lampa.Utils.addUrlComponent(e,c))}}return e}function F(e){return j(e)}function M(e,t){if(!e||!e.length)return"";var a='<span class="online-prestige-split">●</span>';return t?e.map((function(e){return"<span>"+e+"</span>"})).join(a):e.join(a)}var K=Lampa.Reguest;function W(e){var t,a,n,i,o,c,m,p,d,v,f=new K,_=new Lampa.Scroll({mask:!0,over:!0}),L=new Lampa.Explorer(e),y=new Lampa.Filter(e),w={},b=[],x=0,C=0,U=!1,q=null,N={},I={season:Lampa.Lang.translate("torrent_serial_season"),voice:Lampa.Lang.translate("torrent_parser_voice"),source:Lampa.Lang.translate("settings_rest_source")},W={season:[],voice:[]},D=function(){function t(){var e=z();return(e&&window.rch_nws&&window.rch_nws[e]?window.rch_nws[e].type:window.rch&&e&&window.rch[e]?window.rch[e].type:"")||""}return{timeout:function(e){f.timeout(e)},clear:function(){f.clear()},getRchType:t,buildMovieUrl:function(a){var n=[],i=e.movie.source||"tmdb";return n.push("id="+encodeURIComponent(e.movie.id)),e.movie.imdb_id&&n.push("imdb_id="+(e.movie.imdb_id||"")),e.movie.kinopoisk_id&&n.push("kinopoisk_id="+(e.movie.kinopoisk_id||"")),e.movie.tmdb_id&&n.push("tmdb_id="+(e.movie.tmdb_id||"")),n.push("title="+encodeURIComponent(e.clarification?e.search:e.movie.title||e.movie.name)),n.push("original_title="+encodeURIComponent(e.movie.original_title||e.movie.original_name)),n.push("serial="+(e.movie.name?1:0)),n.push("original_language="+(e.movie.original_language||"")),n.push("year="+((e.movie.release_date||e.movie.first_air_date||"0000")+"").slice(0,4)),n.push("source="+i),n.push("clarification="+(e.clarification?1:0)),n.push("similar="+!!e.similar),n.push("rchtype="+t()),j(a,n)},silentPromise:function(e,t,a){return new P((function(n,i){f.silent(e,(function(e){U||n(e)}),(function(e){U||i(e)}),t,a)}))},nativePromise:function(e,t,a){return new P((function(n,i){f.native(e,(function(e){U||n(e)}),(function(e){U||i(e)}),t,a)}))}}}(),V=function(){var t=S.StorageKeys;function a(a){var i=Lampa.Storage.cache(t.OnlineChoicePrefix+(a||n),3e3,{})[e.movie.id]||{};return Lampa.Arrays.extend(i,{season:0,voice:0,voice_name:"",voice_id:0,episodes_view:{},movie_view:""}),i}function i(a,i){var r=Lampa.Storage.cache(t.OnlineChoicePrefix+(i||n),3e3,{});r[e.movie.id]=a,Lampa.Storage.set(t.OnlineChoicePrefix+(i||n),r),o(i||n)}function o(a){var n=Lampa.Storage.cache(t.OnlineLastBalanser,3e3,{});n[e.movie.id]=a,Lampa.Storage.set(t.OnlineLastBalanser,n)}return{getChoice:a,saveChoice:i,replaceChoice:function(e,t){var n=a(t);Lampa.Arrays.extend(n,e,!0),i(n,t)},updateBalanser:o,watched:function(a){var n=Lampa.Utils.hash(e.movie.number_of_seasons?e.movie.original_name:e.movie.original_title),i=Lampa.Storage.cache(t.OnlineWatchedLast,5e3,{});return a?(i[n]||(i[n]={}),Lampa.Arrays.extend(i[n],a,!0),Lampa.Storage.set(t.OnlineWatchedLast,i),!0):i[n]},getLastChoiceBalanser:function(){var a=Lampa.Storage.cache(t.OnlineLastBalanser,3e3,{});return a[e.movie.id]?a[e.movie.id]:Lampa.Storage.get(t.OnlineBalanser,N.length?N[0]:"")}}}(),J=function(){!function(){if(B)return;Lampa.Template.add("lampac_prestige_full",'<div class="online-prestige online-prestige--full selector">\n            <div class="online-prestige__img">\n                <img alt="">\n                <div class="online-prestige__loader"></div>\n            </div>\n            <div class="online-prestige__body">\n                <div class="online-prestige__head">\n                    <div class="online-prestige__title">{title}</div>\n                    <div class="online-prestige__time">{time}</div>\n                </div>\n\n                <div class="online-prestige__timeline"></div>\n\n                <div class="online-prestige__footer">\n                    <div class="online-prestige__info">{info}</div>\n                    <div class="online-prestige__quality">{quality}</div>\n                </div>\n            </div>\n        </div>'),Lampa.Template.add("lampac_content_loading",'<div class="online-empty">\n            <div class="broadcast__scan"><div></div></div>\n\t\t\t\n            <div class="online-empty__templates">\n                <div class="online-empty-template selector">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n            </div>\n        </div>'),Lampa.Template.add("lampac_does_not_answer",'<div class="online-empty">\n            <div class="online-empty__title">\n                #{lampac_balanser_dont_work}\n            </div>\n            <div class="online-empty__time">\n                #{lampac_balanser_timeout}\n            </div>\n            <div class="online-empty__buttons">\n                <div class="online-empty__button selector cancel">#{cancel}</div>\n                <div class="online-empty__button selector change">#{lampac_change_balanser}</div>\n            </div>\n            <div class="online-empty__templates">\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n            </div>\n        </div>'),Lampa.Template.add("lampac_server_not_configured",'<div class="online-empty">\n            <div class="online-empty__title">\n                #{lampac_server_not_set}\n            </div>\n            <div class="online-empty__time">\n                #{lampac_server_not_set_desc}\n            </div>\n            <div class="online-empty__buttons">\n                <div class="online-empty__button selector cancel">#{cancel}</div>\n                <div class="online-empty__button selector enter_server">#{lampac_enter_server}</div>\n            </div>\n            <div class="online-empty__templates">\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n                <div class="online-empty-template">\n                    <div class="online-empty-template__ico"></div>\n                    <div class="online-empty-template__body"></div>\n                </div>\n            </div>\n        </div>'),Lampa.Template.add("lampac_prestige_rate",'<div class="online-prestige-rate">\n            <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M8.39409 0.192139L10.99 5.30994L16.7882 6.20387L12.5475 10.4277L13.5819 15.9311L8.39409 13.2425L3.20626 15.9311L4.24065 10.4277L0 6.20387L5.79819 5.30994L8.39409 0.192139Z" fill="#fff"></path>\n            </svg>\n            <span>{rate}</span>\n        </div>'),Lampa.Template.add("lampac_prestige_folder",'<div class="online-prestige online-prestige--folder selector">\n            <div class="online-prestige__folder">\n                <svg viewBox="0 0 128 112" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <rect y="20" width="128" height="92" rx="13" fill="white"></rect>\n                    <path d="M29.9963 8H98.0037C96.0446 3.3021 91.4079 0 86 0H42C36.5921 0 31.9555 3.3021 29.9963 8Z" fill="white" fill-opacity="0.23"></path>\n                    <rect x="11" y="8" width="106" height="76" rx="13" fill="white" fill-opacity="0.51"></rect>\n                </svg>\n            </div>\n            <div class="online-prestige__body">\n                <div class="online-prestige__head">\n                    <div class="online-prestige__title">{title}</div>\n                    <div class="online-prestige__time">{time}</div>\n                </div>\n\n                <div class="online-prestige__footer">\n                    <div class="online-prestige__info">{info}</div>\n                </div>\n            </div>\n        </div>'),Lampa.Template.add("lampac_prestige_watched",'<div class="online-prestige online-prestige-watched selector">\n            <div class="online-prestige-watched__icon">\n                <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <circle cx="10.5" cy="10.5" r="9" stroke="currentColor" stroke-width="3"/>\n                    <path d="M14.8477 10.5628L8.20312 14.399L8.20313 6.72656L14.8477 10.5628Z" fill="currentColor"/>\n                </svg>\n            </div>\n            <div class="online-prestige-watched__body">\n                \n            </div>\n        </div>'),Lampa.Template.add("lampac_css","\n        <style>\n        @charset 'UTF-8';.online-prestige{position:relative;-webkit-border-radius:.3em;border-radius:.3em;background-color:rgba(0,0,0,0.3);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.online-prestige__body{padding:1.2em;line-height:1.3;-webkit-box-flex:1;-webkit-flex-grow:1;-moz-box-flex:1;-ms-flex-positive:1;flex-grow:1;position:relative}@media screen and (max-width:480px){.online-prestige__body{padding:.8em 1.2em}}.online-prestige__img{position:relative;width:13em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;min-height:8.2em}.online-prestige__img>img{visibility:hidden;position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-webkit-border-radius:.3em;border-radius:.3em;opacity:0;-webkit-transition:opacity .3s;-o-transition:opacity .3s;-moz-transition:opacity .3s;transition:opacity .3s}.online-prestige__img--loaded>img{opacity:1;visibility:visible}@media screen and (max-width:480px){.online-prestige__img{width:7em;min-height:6em}}.online-prestige__folder{padding:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.online-prestige__folder>svg{width:4.4em !important;height:4.4em !important}.online-prestige__viewed{position:absolute;top:1em;left:1em;background:rgba(0,0,0,0.45);-webkit-border-radius:100%;border-radius:100%;padding:.25em;font-size:.76em}.online-prestige__viewed>svg{width:1.5em !important;height:1.5em !important}.online-prestige__episode-number{position:absolute;top:0;left:0;right:0;bottom:0;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-size:2em}.online-prestige__loader{position:absolute;top:50%;left:50%;width:2em;height:2em;margin-left:-1em;margin-top:-1em;background:url(./img/loader.svg) no-repeat center center;-webkit-background-size:contain;-o-background-size:contain;background-size:contain}.online-prestige__head,.online-prestige__footer{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.online-prestige__timeline{margin:.8em 0}.online-prestige__timeline>.time-line{display:block !important}.online-prestige__title{font-size:1.7em;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;line-clamp:1;-webkit-box-orient:vertical}@media screen and (max-width:480px){.online-prestige__title{font-size:1.4em}}.online-prestige__time{padding-left:2em}.online-prestige__info{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.online-prestige__info>*{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;line-clamp:1;-webkit-box-orient:vertical}.online-prestige__quality{padding-left:1em;white-space:nowrap}.online-prestige__scan-file{position:absolute;bottom:0;left:0;right:0}.online-prestige__scan-file .broadcast__scan{margin:0}.online-prestige .online-prestige-split{font-size:.8em;margin:0 1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.online-prestige.focus::after{content:'';position:absolute;top:-0.6em;left:-0.6em;right:-0.6em;bottom:-0.6em;-webkit-border-radius:.7em;border-radius:.7em;border:solid .3em #fff;z-index:-1;pointer-events:none}.online-prestige+.online-prestige{margin-top:1.5em}.online-prestige--folder .online-prestige__footer{margin-top:.8em}.online-prestige-watched{padding:1em}.online-prestige-watched__icon>svg{width:1.5em;height:1.5em}.online-prestige-watched__body{padding-left:1em;padding-top:.1em;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.online-prestige-watched__body>span+span::before{content:' ● ';vertical-align:top;display:inline-block;margin:0 .5em}.online-prestige-rate{display:-webkit-inline-box;display:-webkit-inline-flex;display:-moz-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.online-prestige-rate>svg{width:1.3em !important;height:1.3em !important}.online-prestige-rate>span{font-weight:600;font-size:1.1em;padding-left:.7em}.online-empty{line-height:1.4}.online-empty__title{font-size:1.8em;margin-bottom:.3em}.online-empty__time{font-size:1.2em;font-weight:300;margin-bottom:1.6em}.online-empty__buttons{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex}.online-empty__buttons>*+*{margin-left:1em}.online-empty__button{background:rgba(0,0,0,0.3);font-size:1.2em;padding:.5em 1.2em;-webkit-border-radius:.2em;border-radius:.2em;margin-bottom:2.4em}.online-empty__button.focus{background:#fff;color:black}.online-empty__templates .online-empty-template:nth-child(2){opacity:.5}.online-empty__templates .online-empty-template:nth-child(3){opacity:.2}.online-empty-template{background-color:rgba(255,255,255,0.3);padding:1em;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-border-radius:.3em;border-radius:.3em}.online-empty-template>*{background:rgba(0,0,0,0.3);-webkit-border-radius:.3em;border-radius:.3em}.online-empty-template__ico{width:4em;height:4em;margin-right:2.4em}.online-empty-template__body{height:1.7em;width:70%}.online-empty-template+.online-empty-template{margin-top:1em}.lampac-balanser-loader{display:inline-block;width:1.2em;height:1.2em;margin-top:0;margin-left:0.5em;background:url(./img/loader.svg) no-repeat 50% 50%;background-size:contain}.lampac-similar-img{height:7em;width:7em;border-radius:0.3em;visibility:hidden;}.lampac-dim-opacity{opacity:0.5}\n.lampac-similar-img.loaded { visibility: visible; }\n        </style>\n    "),$("body").append(Lampa.Template.get("lampac_css",{},!0)),B=!0}()},Z=function(){function e(e){if(e.url&&"string"==typeof e.url&&-1!==e.url.indexOf(" or ")){var t=e.url.split(" or ");e.url=t[0],e.url_reserve=t[1]}}return{toPlayElement:function(e){return{title:e.title,url:e.url,quality:e.qualitys,timeline:e.timeline,subtitles:e.subtitles,segments:e.segments,callback:e.mark,season:e.season,episode:e.episode,voice_name:e.voice_name}},orUrlReserve:e,setDefaultQuality:function(t){if(Lampa.Arrays.getKeys(t.quality).length)for(var a in t.quality)parseInt(a)==Lampa.Storage.field("video_quality_default")&&(t.url=t.quality[a],e(t)),-1!==t.quality[a].indexOf(" or ")&&(t.quality[a]=t.quality[a].split(" or ")[0])},loadSubtitles:function(e){f.silent(F(e),(function(e){Lampa.Player.subtitles(e)}),(function(e){console.error(e)}))}}}();function G(e){var t=e.balanser,a=e.name.split(" ")[0];return(t||a).toLowerCase()}A(),this.showServerNotConfigured=function(){var e=Lampa.Template.get("lampac_server_not_configured",{});e.find(".cancel").on("hover:enter",(function(){Lampa.Activity.backward()})),e.find(".enter_server").on("hover:enter",(function(){H()})),_.clear(),_.append(e),this.loading(!1)},this.initialize=function(){J();var t=this;if(!u())return this.loading(!0),_.body().addClass("torrent-list"),L.appendFiles(_.render()),Lampa.Controller.enable("content"),void this.showServerNotConfigured();function a(){!function(){clearTimeout(v),v=0,q=null;var t=Lampa.Utils.hash(e.movie.number_of_seasons?e.movie.original_name:e.movie.original_title),a=Lampa.Storage.get(S.StorageKeys.ClarificationSearch,"{}");delete a[t],Lampa.Storage.set(S.StorageKeys.ClarificationSearch,a)}(),t.replaceChoice({season:0,voice:0,voice_url:"",voice_name:""}),clearTimeout(p),p=setTimeout((function(){U||(Lampa.Select.close(),Lampa.Activity.replace({clarification:0,similar:0}))}),10)}this.loading(!0),y.onSearch=function(t){!function(t){q=t,clearTimeout(v),v=setTimeout((function(){if(!U){var t=Lampa.Utils.hash(e.movie.number_of_seasons?e.movie.original_name:e.movie.original_title),a=Lampa.Storage.get(S.StorageKeys.ClarificationSearch,"{}");a[t]=q,Lampa.Storage.set(S.StorageKeys.ClarificationSearch,a),v=0}}),500)}(t),Lampa.Activity.replace({search:t,clarification:!0,similar:!0})},y.onBack=function(){t.start()},y.render().find(".selector").on("hover:enter",(function(){clearInterval(o)})),y.render().find(".filter--search").appendTo(y.render().find(".torrent-filter")),y.onSelect=function(n,o,c){if("filter"==n)o.reset?a():function(e,a){var n=W[e.stype][a.index].url,i=t.getChoice();"voice"==e.stype&&(i.voice_name=W.voice[a.index].title,i.voice_url=n),i[e.stype]=a.index,t.saveChoice(i),t.reset(),t.request(n),clearTimeout(d),d=setTimeout((function(){U||Lampa.Select.close()}),10)}(o,c);else if("sort"==n)!function(a){Lampa.Select.close(),e.lampac_custom_select=a.source,t.changeBalanser(a.source)}(o);else if("server"==n)if(Lampa.Select.close(),o.add)H((function(e){if(e){var t=r()[l()]||"";i.find("div").text(t?g(t):Lampa.Lang.translate("lampac_not_set")),Lampa.Activity.replace()}}));else{s(o.index);var m=r()[o.index]||"";h(m)?k((function(){})):O(),i.find("div").text(m?g(m):Lampa.Lang.translate("lampac_not_set")),Lampa.Activity.replace()}},y.addButtonBack&&y.addButtonBack(),y.render().find(".filter--sort span").text(Lampa.Lang.translate("lampac_balanser"));var i=$('<div class="simple-button simple-button--filter selector filter--server"><span>'+Lampa.Lang.translate("lampac_server_short")+"</span><div></div></div>");function c(){var e=r()[l()]||"";return e?g(e):Lampa.Lang.translate("lampac_not_set")}if(i.find("div").text(c()),i.on("hover:enter",(function(){Q((function(){i.find("div").text(c())}))})),y.render().find(".filter--sort").before(i),_.body().addClass("torrent-list"),L.appendFiles(_.render()),L.appendHead(y.render()),_.minus(L.render().find(".explorer__files-head")),_.body().append(Lampa.Template.get("lampac_content_loading")),Lampa.Controller.enable("content"),this.loading(!1),e.balanser){L.render().find(".filter--search").remove(),(w={})[e.balanser]={name:e.balanser},n=e.balanser,N=[];var m=F(e.url.replace("rjson=","nojson="));return f.native(m,function(e){U||this.parse(e)}.bind(this),(function(e){U||(L.render().find(".torrent-filter").remove(),t.empty())}),!1,{dataType:"text"})}this.externalids().then((function(){if(!U)return t.createSource()})).then((function(e){if(!U)return A().then((function(t){if(!U){for(var a=!1,i=0;i<t.length;i++){var o=t[i];if(n.slice(0,o.length)==o){a=!0;break}}return a||y.render().find(".filter--search").addClass("hide"),e}}))})).then((function(){U||t.search()})).catch((function(e){U||t.noConnectToServer(e)}))},this.rch=function(e,t){var a=this;E(e,(function(){U||(t?t():a.find())}))},this.externalids=function(){if(e.movie.imdb_id&&e.movie.kinopoisk_id)return P.resolve();var t=[];t.push("id="+encodeURIComponent(e.movie.id)),t.push("serial="+(e.movie.name?1:0)),e.movie.imdb_id&&t.push("imdb_id="+(e.movie.imdb_id||"")),e.movie.kinopoisk_id&&t.push("kinopoisk_id="+(e.movie.kinopoisk_id||""));var a=F(T.getLocalhost()+"externalids?"+t.join("&"));return D.timeout(1e4),D.silentPromise(a).then((function(t){if(!U)for(var a in t)e.movie[a]=t[a]})).catch((function(e){U||console.error(e)}))},this.updateBalanser=function(e){V.updateBalanser(e)},this.changeBalanser=function(e){this.updateBalanser(e),Lampa.Storage.set(S.StorageKeys.OnlineBalanser,e);var t=this.getChoice(e),a=this.getChoice();a.voice_name&&(t.voice_name=a.voice_name),this.saveChoice(t,e),Lampa.Activity.replace()},this.requestParams=function(e){return D.buildMovieUrl(e)},this.getLastChoiceBalanser=function(){return V.getLastChoiceBalanser()},this.startSource=function(t){if(t.forEach((function(e){var t=G(e);w[t]={url:e.url,name:e.name,show:void 0===e.show||e.show}})),!(N=Lampa.Arrays.getKeys(w)).length)return P.reject();var i=Lampa.Storage.cache(S.StorageKeys.OnlineLastBalanser,3e3,{});return n=i[e.movie.id]?i[e.movie.id]:Lampa.Storage.get(S.StorageKeys.OnlineBalanser,N[0]),w[n]||(n=N[0]),w[n].show||e.lampac_custom_select||(n=N[0]),a=w[n].url,Lampa.Storage.set(S.StorageKeys.ActiveBalanser,n),P.resolve(t)},this.lifeSource=function(){var e=this;return new P((function(t,a){var i=e.requestParams(T.getLocalhost()+"lifeevents?memkey="+(e.memkey||"")),o=!1,r=!1;function l(){m=setTimeout((function(){U||r||c()}),1e3)}function s(n,i){if(n&&n.accsdb)return r=!0,void a(n);if(!o){var l=e.getLastChoiceBalanser();n.online.filter((function(e){return i?e.show:e.show&&e.name.toLowerCase()==l})).length?(o=!0,t(n.online.filter((function(e){return e.show})))):i&&(r=!0,a())}}function c(){D.timeout(3e3),D.silentPromise(i).then((function(t){if(!U){C++,N=[],w={},t.online.forEach((function(e){var t=G(e);w[t]={url:e.url,name:e.name,show:void 0===e.show||e.show}})),N=Lampa.Arrays.getKeys(w),y.set("sort",N.map((function(e){return{title:w[e].name,source:e,selected:e==n,ghost:!w[e].show}}))),y.chosen("sort",[w[n]?w[n].name:n]),s(t,!1);var a=e.getLastChoiceBalanser();C>15||t.ready?(r=!0,y.render().find(".lampac-balanser-loader").remove(),s(t,!0)):!o&&w[a]&&w[a].show?(s(t,!0),l()):l()}})).catch((function(e){U||(++C>15?(r=!0,a(e)):l())}))}c()}))},this.createSource=function(){var t=this,a=t.requestParams(T.getLocalhost()+"lite/events?life=true");return D.timeout(15e3),D.silentPromise(a).then((function(a){if(!U)return a.accsdb?P.reject(a):a.life?(t.memkey=a.memkey,a.title&&(e.movie.name&&(e.movie.name=a.title),e.movie.title&&(e.movie.title=a.title)),y.render().find(".filter--sort").append('<span class="lampac-balanser-loader"></span>'),t.lifeSource().then((function(e){if(!U)return t.startSource(e)}))):t.startSource(a)}))},this.create=function(){return this.render()},this.search=function(){this.filter({source:N},this.getChoice()),this.find()},this.find=function(){this.request(this.requestParams(a))},this.request=function(e){x++;var t=F(e);x<10?(f.native(t,function(e){U||this.parse(e)}.bind(this),this.doesNotAnswer.bind(this),!1,{dataType:"text"}),clearTimeout(c),c=setTimeout((function(){U||(x=0)}),4e3)):this.empty()},this.parseJsonDate=function(t,a){var n=[];if("string"!=typeof t)return[];var i=null;try{if(R||"undefined"==typeof DOMParser||(R=new DOMParser),R){var o=R.parseFromString("<div>"+t+"</div>","text/html");o&&o.body&&(i=o.body)}}catch(e){}if(!i)try{(i=document.createElement("div")).innerHTML=t}catch(e){return n}var r=[];try{r=i.querySelectorAll?i.querySelectorAll(a):[]}catch(e){r=[]}for(var l=0;l<r.length;l++){var s=r[l];try{var c=s.getAttribute("data-json");if(!c)continue;var m=JSON.parse(c),p=s.getAttribute("s"),d=s.getAttribute("e"),u=s.textContent||s.innerText||"";e.movie.name||(u.match(/\d+p/i)&&(m.quality||(m.quality={},m.quality[u]=m.url),u=e.movie.title),"По умолчанию"==u&&(u=e.movie.title)),d&&(m.episode=parseInt(d)),p&&(m.season=parseInt(p)),u&&(m.text=u),m.active=-1!==(" "+(s.className||"")+" ").indexOf(" active "),n.push(m)}catch(e){console.error(e)}}return n},this.getFileUrl=function(e,t,a){var n=this;if("inner"!==Lampa.Storage.field("player")&&e.stream&&Lampa.Platform.is("apple")){var i=Lampa.Arrays.clone(e);i.method="play",i.url=e.stream,t(i,{})}else"play"==e.method?t(e,{}):(Lampa.Loading.start((function(){Lampa.Loading.stop(),Lampa.Controller.toggle("content"),f.clear()})),f.native(F(e.url),(function(i){U||(i.rch?a?(Lampa.Loading.stop(),t(!1,{})):n.rch(i,(function(){U||(Lampa.Loading.stop(),n.getFileUrl(e,t,!0))})):(Lampa.Loading.stop(),t(i,i)))}),(function(){U||(Lampa.Loading.stop(),t(!1,{}))})))},this.toPlayElement=function(e){return Z.toPlayElement(e)},this.orUrlReserve=function(e){Z.orUrlReserve(e)},this.setDefaultQuality=function(e){Z.setDefaultQuality(e)},this.display=function(e){var t=this;this.draw(e,{onEnter:function(a,i){t.getFileUrl(a,(function(i,o){if(i&&i.url){var r=[],l=t.toPlayElement(a);if(l.url=i.url,l.headers=o.headers||i.headers,l.quality=o.quality||a.qualitys,l.segments=o.segments||a.segments,l.hls_manifest_timeout=o.hls_manifest_timeout||i.hls_manifest_timeout,l.subtitles=i.subtitles,l.subtitles_call=o.subtitles_call||i.subtitles_call,i.vast&&i.vast.url&&(l.vast_url=i.vast.url,l.vast_msg=i.vast.msg,l.vast_region=i.vast.region,l.vast_platform=i.vast.platform,l.vast_screen=i.vast.screen),t.orUrlReserve(l),t.setDefaultQuality(l),a.season?e.forEach((function(e){var n=t.toPlayElement(e);e==a?n.url=i.url:"call"==e.method?"inner"!==Lampa.Storage.field("player")?(n.url=e.stream,delete n.quality):n.url=function(a){t.getFileUrl(e,(function(i,o){i.url?(n.url=i.url,n.quality=o.quality||e.qualitys,n.segments=o.segments||e.segments,n.subtitles=i.subtitles,t.orUrlReserve(n),t.setDefaultQuality(n),e.mark()):(n.url="",Lampa.Noty.show(Lampa.Lang.translate("lampac_nolink"))),a()}),(function(){n.url="",a()}))}:n.url=e.url,t.orUrlReserve(n),t.setDefaultQuality(n),r.push(n)})):r.push(l),r.length>1&&(l.playlist=r),l.url){var s=l;s.isonline=!0,Lampa.Player.play(s),Lampa.Player.playlist(r),s.subtitles_call&&t.loadSubtitles(s.subtitles_call),a.mark(),t.updateBalanser(n)}else Lampa.Noty.show(Lampa.Lang.translate("lampac_nolink"))}else Lampa.Noty.show(Lampa.Lang.translate("lampac_nolink"))}),!0)},onContextMenu:function(e,a,n,i){t.getFileUrl(e,(function(t){i({file:t.url,quality:e.qualitys})}),!0)}}),this.filter({season:W.season.map((function(e){return e.title})),voice:W.voice.map((function(e){return e.title}))},this.getChoice())},this.loadSubtitles=function(e){Z.loadSubtitles(e)},this.parse=function(e){if(!U){var t=Lampa.Arrays.decodeJson(e,{});if(Lampa.Arrays.isObject(e)&&e.rch&&(t=e),t.rch)return this.rch(t);try{var a=this.parseJsonDate(e,".videos__item"),i=this.parseJsonDate(e,".videos__button");if(1!=a.length||"link"!=a[0].method||a[0].similar){this.activity.loader(!1);var o=a.filter((function(e){return"play"==e.method||"call"==e.method})),r=a.filter((function(e){return e.similar}));if(o.length)if(i.length){W.voice=i.map((function(e){return{title:e.text,url:e.url}}));for(var l=this.getChoice(n).voice_url,s=this.getChoice(n).voice_name,c=null,m=null,p=null,d=0;d<i.length;d++){var u=i[d];if(c||u.url!=l||(c=u),m||u.text!=s||(m=u),!p&&u.active&&(p=u),c&&m&&p)break}c&&!c.active?(this.replaceChoice({voice:i.indexOf(c),voice_name:c.text}),this.request(c.url)):m&&!m.active?(this.replaceChoice({voice:i.indexOf(m),voice_name:m.text}),this.request(m.url)):(p&&this.replaceChoice({voice:i.indexOf(p),voice_name:p.text}),this.display(o))}else this.replaceChoice({voice:0,voice_url:"",voice_name:""}),this.display(o);else if(a.length)if(r.length)this.similars(r),this.activity.loader(!1);else{W.season=a.map((function(e){return{title:e.text,url:e.url}}));var v=this.getChoice(n).season,f=W.season[v];f||(f=W.season[0]),this.request(f.url)}else this.doesNotAnswer(t)}else W.season=a.map((function(e){return{title:e.text,url:e.url}})),this.replaceChoice({season:0}),this.request(a[0].url)}catch(e){this.doesNotAnswer(e)}}},this.similars=function(a){var n=this,i=document.createDocumentFragment();a.forEach((function(a){a.title=a.text,a.info="";var o=[],r=((a.start_date||a.year||e.movie.release_date||e.movie.first_air_date||"")+"").slice(0,4);r&&o.push(r),a.details&&o.push(a.details);var l=a.title||a.text;a.title=l,a.time=a.time||"",a.info=M(o);var s=Lampa.Template.get("lampac_prestige_folder",a);if(a.img){var c=$('<img class="lampac-similar-img"/>'),m=c[0];s.find(".online-prestige__folder").empty().append(c),b.push(m),void 0!==a.img&&("/"===a.img.charAt(0)&&(a.img=T.getLocalhost()+a.img.substring(1)),-1!==a.img.indexOf("/proxyimg")&&(a.img=F(a.img)));var p=new Image;p.onload=function(){U||(m.src=p.src,-1==(" "+m.className+" ").indexOf(" loaded ")&&(m.className=(m.className?m.className+" ":"")+"loaded"))},p.onerror=function(){U||(m.src="./img/img_broken.svg",-1==(" "+m.className+" ").indexOf(" loaded ")&&(m.className=(m.className?m.className+" ":"")+"loaded"))},p.src=a.img,b.push(p)}s.on("hover:enter",(function(){n.reset(),n.request(a.url)})).on("hover:focus",(function(e){t=e.target,_.update($(e.target),!0)})),s&&s[0]&&i.appendChild(s[0])})),_.clear(),_.body()[0].appendChild(i),this.filter({season:W.season.map((function(e){return e.title})),voice:W.voice.map((function(e){return e.title}))},this.getChoice()),Lampa.Controller.enable("content")},this.getChoice=function(e){return V.getChoice(e)},this.saveChoice=function(e,t){V.saveChoice(e,t)},this.replaceChoice=function(e,t){V.replaceChoice(e,t)},this.clearImages=function(){b.forEach((function(e){if(e)try{e.onerror=null,e.onload=null,e.removeAttribute("src")}catch(e){console.error(e)}})),b=[]},this.reset=function(){t=!1,clearInterval(o),clearTimeout(m),clearTimeout(c),clearTimeout(p),clearTimeout(d),f.clear(),this.clearImages(),_.render().find(".empty").remove(),_.clear(),_.reset(),_.body().append(Lampa.Template.get("lampac_content_loading"))},this.loading=function(e){e?this.activity.loader(!0):(this.activity.loader(!1),this.activity.toggle())},this.filter=function(e,t){var a,i,o,s,c=this,m=[],p=function(t,a){var n=c.getChoice(),i=e[t],o=[],r=n[t];i.forEach((function(e,t){o.push({title:e,selected:r==t,index:t})})),m.push({title:a,subtitle:i[r],items:o,stype:t})};e.source=N,m.push({title:Lampa.Lang.translate("torrent_parser_reset"),reset:!0}),this.saveChoice(t),e.voice&&e.voice.length&&p("voice",Lampa.Lang.translate("torrent_parser_voice")),e.season&&e.season.length&&p("season",Lampa.Lang.translate("torrent_serial_season")),y.set("filter",m),y.set("server",(a=r(),i=l(),(o=a.map((function(e,t){return{title:g(e),index:t,selected:t===i}}))).push({title:Lampa.Lang.translate("lampac_add_server"),add:!0}),o)),y.set("sort",N.map((function(e){return{title:w[e].name,source:e,selected:e==n,ghost:!w[e].show}}))),y.chosen("server",[(s=r()[l()]||"",s?g(s):Lampa.Lang.translate("lampac_not_set"))]),this.selected(e)},this.selected=function(e){var t=this.getChoice(),a=[];for(var i in t)e[i]&&e[i].length&&("voice"==i?a.push(I[i]+": "+e[i][t[i]]):"source"!==i&&e.season.length>=1&&a.push(I.season+": "+e[i][t[i]]));y.chosen("filter",a),y.chosen("sort",[w[n].name])},this.getEpisodes=function(t,a){var n=[],i=e.movie.id;-1==["cub","tmdb"].indexOf(e.movie.source||"tmdb")&&(i=e.movie.tmdb_id),"number"==typeof i&&e.movie.name?Lampa.Api.sources.tmdb.get("tv/"+i+"/season/"+t,{},(function(e){U||(n=e.episodes||[],a(n))}),(function(){U||a(n)})):a(n)},this.watched=function(e){if(!e)return V.watched();V.watched(e),this.updateWatched()},this.updateWatched=function(){var e=this.watched(),t=_.body().find(".online-prestige-watched .online-prestige-watched__body").empty();if(e){var a=[];e.balanser_name&&a.push(e.balanser_name),e.voice_name&&a.push(e.voice_name),e.season&&a.push(Lampa.Lang.translate("torrent_serial_season")+" "+e.season),e.episode&&a.push(Lampa.Lang.translate("torrent_serial_episode")+" "+e.episode),a.forEach((function(e){t.append("<span>"+e+"</span>")}))}else t.append("<span>"+Lampa.Lang.translate("lampac_no_watch_history")+"</span>")},this.draw=function(a){var i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!a.length)return this.empty();this.getEpisodes(a[0].season,(function(r){if(!U){var l=Lampa.Storage.cache(S.StorageKeys.OnlineView,5e3,[]),s=!!e.movie.name,c=i.getChoice(),m=window.innerWidth>480,p=!1,d=!1,u=document.createDocumentFragment(),v=[];if(a.forEach((function(f,h){var g=!1;if(s&&r.length&&!o.similars)for(var L=0;L<r.length;L++)if(r[L].episode_number==f.episode){g=r[L];break}var y=f.episode||h+1,b=c.episodes_view[f.season],k=c.voice_name||!!W.voice[0]&&W.voice[0].title||f.voice_name||(s?"Неизвестно":f.text)||"Неизвестно";f.quality&&(f.qualitys=f.quality,f.quality=Lampa.Arrays.getKeys(f.quality)[0]),Lampa.Arrays.extend(f,{voice_name:k,info:k.length>60?k.substr(0,60)+"...":k,quality:"",time:Lampa.Utils.secondsToTime(60*(g?g.runtime:e.movie.runtime),!0)});var x=Lampa.Utils.hash(f.season?[f.season,f.season>10?":":"",f.episode,e.movie.original_title].join(""):e.movie.original_title),C=Lampa.Utils.hash(f.season?[f.season,f.season>10?":":"",f.episode,e.movie.original_title,f.voice_name].join(""):e.movie.original_title+f.voice_name),T={hash_timeline:x,hash_behold:C},A=[];f.season&&(f.translate_episode_end=i.getLastEpisode(a),f.translate_voice=f.voice_name),f.text&&!g&&(f.title=f.text),f.timeline=Lampa.Timeline.view(x),g?(f.title=g.name,f.info.length<30&&g.vote_average&&A.push(Lampa.Template.get("lampac_prestige_rate",{rate:parseFloat(g.vote_average+"").toFixed(1)},!0)),g.air_date&&m&&A.push(Lampa.Utils.parseTime(g.air_date).full)):e.movie.release_date&&m&&A.push(Lampa.Utils.parseTime(e.movie.release_date).full),!s&&e.movie.tagline&&f.info.length<30&&A.push(e.movie.tagline),f.info&&A.push(f.info),A.length&&(f.info=M(A,!0));var z=Lampa.Template.get("lampac_prestige_full",f),O=z.find(".online-prestige__loader"),q=z.find(".online-prestige__img");if(e.balanser&&q.hide(),s?void 0!==b&&b==y&&(p=z):c.movie_view==C&&(p=z),s&&!g)q.append('<div class="online-prestige__episode-number">'+("0"+(f.episode||h+1)).slice(-2)+"</div>"),O.remove();else if(s||"undefined"!=e.movie.backdrop_path){var N=z.find("img")[0],R=new Image;R.onload=function(){U||(N.src=R.src,q.addClass("online-prestige__img--loaded loaded"),O.remove(),s&&q.append('<div class="online-prestige__episode-number">'+("0"+(f.episode||h+1)).slice(-2)+"</div>"))},R.onerror=function(){U||(N.src="./img/img_broken.svg",q.addClass("online-prestige__img--loaded loaded"),O.remove(),s&&q.append('<div class="online-prestige__episode-number">'+("0"+(f.episode||h+1)).slice(-2)+"</div>"))},R.src=Lampa.TMDB.image("t/p/w300"+(g?g.still_path:e.movie.backdrop_path)),v.push(N),v.push(R)}else O.remove();z.find(".online-prestige__timeline").append(Lampa.Timeline.render(f.timeline)),-1!==l.indexOf(C)&&(d=z,z.find(".online-prestige__img").append('<div class="online-prestige__viewed">'+Lampa.Template.get("icon_viewed",{},!0)+"</div>")),f.mark=function(){-1==(l=Lampa.Storage.cache(S.StorageKeys.OnlineView,5e3,[])).indexOf(C)&&(l.push(C),Lampa.Storage.set(S.StorageKeys.OnlineView,l),0==z.find(".online-prestige__viewed").length&&z.find(".online-prestige__img").append('<div class="online-prestige__viewed">'+Lampa.Template.get("icon_viewed",{},!0)+"</div>")),c=i.getChoice(),s?c.episodes_view[f.season]=y:c.movie_view=C,i.saveChoice(c);var e=c.voice_name||f.voice_name||f.title;e.length>30&&(e=e.slice(0,30)+"..."),i.watched({balanser:n,balanser_name:Lampa.Utils.capitalizeFirstLetter(w[n]?w[n].name.split(" ")[0]:n),voice_id:c.voice_id,voice_name:e,episode:f.episode,season:f.season})},f.unmark=function(){-1!==(l=Lampa.Storage.cache(S.StorageKeys.OnlineView,5e3,[])).indexOf(C)&&(Lampa.Arrays.remove(l,C),Lampa.Storage.set(S.StorageKeys.OnlineView,l),Lampa.Storage.remove(S.StorageKeys.OnlineView,C),z.find(".online-prestige__viewed").remove())},f.timeclear=function(){f.timeline.percent=0,f.timeline.time=0,f.timeline.duration=0,Lampa.Timeline.update(f.timeline)},z.on("hover:enter",(function(){e.movie.id&&Lampa.Favorite.add("history",e.movie,100),o.onEnter&&o.onEnter(f,z,T)})).on("hover:focus",(function(e){t=e.target,o.onFocus&&o.onFocus(f,z,T),_.update($(e.target),!0)})),o.onRender&&o.onRender(f,z,T),i.contextMenu({html:z,element:f,onFile:function(e){o.onContextMenu&&o.onContextMenu(f,z,T,e)},onClearAllMark:function(){a.forEach((function(e){e.unmark()}))},onClearAllTime:function(){a.forEach((function(e){e.timeclear()}))}}),z&&z[0]&&u.appendChild(z[0])})),s&&r.length>a.length&&!o.similars){var f=r.slice(a.length),h=Lampa.Lang.translate("full_episode_days_left");f.forEach((function(n){var i=[];n.vote_average&&i.push(Lampa.Template.get("lampac_prestige_rate",{rate:parseFloat(n.vote_average+"").toFixed(1)},!0)),n.air_date&&i.push(Lampa.Utils.parseTime(n.air_date).full);var o=new Date((n.air_date+"").replace(/-/g,"/")),r=Date.now(),l=Math.round((o.getTime()-r)/864e5),s=h+": "+l,c=Lampa.Template.get("lampac_prestige_full",{time:Lampa.Utils.secondsToTime(60*(n?n.runtime:e.movie.runtime),!0),info:M(i,!0),title:n.name,quality:l>0?s:""}),m=c.find(".online-prestige__loader"),p=c.find(".online-prestige__img"),d=a[0]?a[0].season:1;c.find(".online-prestige__timeline").append(Lampa.Timeline.render(Lampa.Timeline.view(Lampa.Utils.hash([d,n.episode_number,e.movie.original_title].join("")))));var f=c.find("img")[0];if(n.still_path){var g=new Image;g.onload=function(){U||(f.src=g.src,p.addClass("online-prestige__img--loaded loaded"),m.remove(),p.append('<div class="online-prestige__episode-number">'+("0"+n.episode_number).slice(-2)+"</div>"))},g.onerror=function(){U||(f.src="./img/img_broken.svg",p.addClass("online-prestige__img--loaded loaded"),m.remove(),p.append('<div class="online-prestige__episode-number">'+("0"+n.episode_number).slice(-2)+"</div>"))},g.src=Lampa.TMDB.image("t/p/w300"+n.still_path),v.push(f),v.push(g)}else m.remove(),p.append('<div class="online-prestige__episode-number">'+("0"+n.episode_number).slice(-2)+"</div>");c.on("hover:focus",(function(e){t=e.target,_.update($(e.target),!0)})),c.addClass("lampac-dim-opacity"),c&&c[0]&&u.appendChild(c[0])}))}_.clear(),i.clearImages();try{e.balanser||_.append(Lampa.Template.get("lampac_prestige_watched",{}))}catch(t){J(),e.balanser||_.append(Lampa.Template.get("lampac_prestige_watched",{}))}i.updateWatched(),_.body()[0].appendChild(u),b=v,p?t=p[0]:d&&(t=d[0]),Lampa.Controller.enable("content")}}))},this.contextMenu=function(t){t.html.on("hover:long",(function(){t.onFile((function(a){var n=Lampa.Controller.enabled().name,i=[];Lampa.Platform.is("webos")&&i.push({title:Lampa.Lang.translate("player_lauch")+" - Webos",player:"webos"}),Lampa.Platform.is("android")&&i.push({title:Lampa.Lang.translate("player_lauch")+" - Android",player:"android"}),i.push({title:Lampa.Lang.translate("player_lauch")+" - Lampa",player:"lampa"}),i.push({title:Lampa.Lang.translate("lampac_video"),separator:!0}),i.push({title:Lampa.Lang.translate("torrent_parser_label_title"),mark:!0}),i.push({title:Lampa.Lang.translate("torrent_parser_label_cancel_title"),unmark:!0}),i.push({title:Lampa.Lang.translate("time_reset"),timeclear:!0}),a&&i.push({title:Lampa.Lang.translate("copy_link"),copylink:!0}),window.lampac_online_context_menu&&window.lampac_online_context_menu.push(i,a,t),i.push({title:Lampa.Lang.translate("more"),separator:!0}),Lampa.Account.logged()&&t.element&&void 0!==t.element.season&&t.element.translate_voice&&i.push({title:Lampa.Lang.translate("lampac_voice_subscribe"),subscribe:!0}),i.push({title:Lampa.Lang.translate("lampac_clear_all_marks"),clearallmark:!0}),i.push({title:Lampa.Lang.translate("lampac_clear_all_timecodes"),timeclearall:!0}),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:i,onBack:function(){Lampa.Controller.toggle(n)},onSelect:function(i){if(i.mark&&t.element.mark(),i.unmark&&t.element.unmark(),i.timeclear&&t.element.timeclear(),i.clearallmark&&t.onClearAllMark(),i.timeclearall&&t.onClearAllTime(),window.lampac_online_context_menu&&window.lampac_online_context_menu.onSelect(i,t),Lampa.Controller.toggle(n),i.player&&(Lampa.Player.runas(i.player),t.html.trigger("hover:enter")),i.copylink)if(a.quality){var o=[];for(var r in a.quality)o.push({title:r,file:a.quality[r]});Lampa.Select.show({title:Lampa.Lang.translate("settings_server_links"),items:o,onBack:function(){Lampa.Controller.toggle(n)},onSelect:function(e){Lampa.Utils.copyTextToClipboard(e.file,(function(){Lampa.Noty.show(Lampa.Lang.translate("copy_secuses"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("copy_error"))}))}})}else Lampa.Utils.copyTextToClipboard(a.file,(function(){Lampa.Noty.show(Lampa.Lang.translate("copy_secuses"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("copy_error"))}));i.subscribe&&Lampa.Account.subscribeToTranslation({card:e.movie,season:t.element.season,episode:t.element.translate_episode_end,voice:t.element.translate_voice},(function(){Lampa.Noty.show(Lampa.Lang.translate("lampac_voice_success"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("lampac_voice_error"))}))}})}))})).on("hover:focus",(function(){Lampa.Helper&&Lampa.Helper.show("online_file",Lampa.Lang.translate("helper_online_file"),t.html)}))},this.empty=function(){var e=Lampa.Template.get("lampac_does_not_answer",{});e.find(".online-empty__buttons").remove(),e.find(".online-empty__title").text(Lampa.Lang.translate("empty_title_two")),e.find(".online-empty__time").text(Lampa.Lang.translate("empty_text")),_.clear(),_.append(e),this.loading(!1)},this.noConnectToServer=function(e){if(!U){var t=Lampa.Template.get("lampac_does_not_answer",{});t.find(".online-empty__buttons").remove(),t.find(".online-empty__title").text(Lampa.Lang.translate("title_error"));var a=w[n]?w[n].name:n;t.find(".online-empty__time").text(e&&e.accsdb?e.msg:Lampa.Lang.translate("lampac_does_not_answer_text").replace("{balanser}",a)),_.clear(),_.append(t),this.loading(!1)}},this.doesNotAnswer=function(e){if(!U){var t=this;this.reset();var a=Lampa.Template.get("lampac_does_not_answer",{balanser:n});e&&e.accsdb&&a.find(".online-empty__title").html(e.msg);var i=e&&e.accsdb?10:5;a.find(".cancel").on("hover:enter",(function(){clearInterval(o)})),a.find(".change").on("hover:enter",(function(){clearInterval(o),y.render().find(".filter--sort").trigger("hover:enter")})),_.clear(),_.append(a),this.loading(!1),o=setInterval((function(){if(!U&&(i--,a.find(".timeout").text(i),0==i)){clearInterval(o);var e=Lampa.Arrays.getKeys(w),r=e.indexOf(n),l=e[r+1];l||(l=e[0]),n=l,Lampa.Activity.active().activity==t.activity&&t.changeBalanser(n)}}),1e3)}},this.getLastEpisode=function(e){var t=0;return e.forEach((function(e){void 0!==e.episode&&(t=Math.max(t,parseInt(e.episode)))})),t},this.start=function(){Lampa.Activity.active().activity===this.activity&&(i||(i=!0,this.initialize()),Lampa.Background.immediately(Lampa.Utils.cardImgBackgroundBlur(e.movie)),Lampa.Controller.add("content",{toggle:function(){Lampa.Controller.collectionSet(_.render(),L.render()),Lampa.Controller.collectionFocus(function(){if(!t)return!1;try{var e=_.render();if(e&&e[0]&&e[0].contains&&!e[0].contains(t))return!1}catch(e){return console.error(e),!1}return t}(),_.render())},gone:function(){clearInterval(o)},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.move("down")},right:function(){Navigator.canmove("right")?Navigator.move("right"):y.show(Lampa.Lang.translate("title_filter"),"filter")},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},back:this.back.bind(this)}),Lampa.Controller.toggle("content"))},this.render=function(){return L.render()},this.back=function(){Lampa.Activity.backward()},this.pause=function(){},this.stop=function(){},this.destroy=function(){U=!0,t=!1;var a=v;if(clearTimeout(v),v=0,a&&null!==q){var n=Lampa.Utils.hash(e.movie.number_of_seasons?e.movie.original_name:e.movie.original_title),i=Lampa.Storage.get(S.StorageKeys.ClarificationSearch,"{}");i[n]=q,Lampa.Storage.set(S.StorageKeys.ClarificationSearch,i)}f.clear(),this.clearImages(),L.destroy(),_.destroy(),clearInterval(o),clearTimeout(m),clearTimeout(c),clearTimeout(p),clearTimeout(d)}}function D(e){e.find(".lamponline-server-item").remove();var t=r(),a=l(),n=e.find(".settings-param-title").last();if(n.length||(n=e.find(".settings-param").last()),t.forEach((function(t,i){var o=g(t),r=i===a,l=!!L(t),s=[];r&&s.push("Текущий сервер"),l&&s.push("Токен установлен");var c=s.join(" • "),m=$('<div class="settings-param selector lamponline-server-item" data-server-index="'+i+'"><div class="settings-param__name">'+o+'</div><div class="settings-param__value"></div>'+(c?'<div class="settings-param__descr">'+c+"</div>":"")+"</div>");m.on("hover:enter",(function(){J(i,o,(function(){D(e)}))})),n.after(m),n=m})),0===t.length){var i=$('<div class="settings-param lamponline-server-item"><div class="settings-param__name" style="opacity: 0.5">'+Lampa.Lang.translate("lampac_not_set")+"</div></div>");n.after(i)}e.find(".lamponline-server-item").on("hover:focus",(function(){Lampa.Params.listener.send("update_scroll_position")})),Lampa.Params.listener.send("update_scroll")}function V(a,n){var i=r();if(a>=0&&a<i.length&&n){var o=i[a];return i[a]=n,Lampa.Storage.set(t,i),Lampa.Storage.get(e,"")===o&&Lampa.Storage.set(e,n),!0}return!1}function J(e,t,a,n){var i=r(),o=l(),c=e===o,p=i[e],d=L(p),u=[];c||u.push({title:Lampa.Lang.translate("lampac_select_this"),select:!0}),n&&(u.push({title:d?"Изменить токен":"Добавить токен",token:!0}),d&&u.push({title:"Удалить токен",removeToken:!0})),u.push({title:Lampa.Lang.translate("lampac_edit_server"),edit:!0}),u.push({title:Lampa.Lang.translate("lampac_delete_server"),remove:!0});var v=Lampa.Controller.enabled().name;Lampa.Select.show({title:t,items:u,onBack:function(){Lampa.Controller.toggle(v)},onSelect:function(t){t.select?(s(e),O(),a&&a(),Lampa.Controller.toggle(v),setTimeout((function(){var t=$(".lamponline-server-item.selector");t.length>0&&e<t.length&&(Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(t[e],$(".settings")[0]))}),10)):t.token?(Lampa.Select.close(),Lampa.Input.edit({title:"Токен сервера",value:d,nosave:!0,free:!0,nomic:!0},(function(t){null!==t&&(y(p,t.trim()),t.trim()&&Lampa.Noty.show("Токен сохранён")),a&&a(),Lampa.Controller.toggle(v),setTimeout((function(){var t=$(".lamponline-server-item.selector");t.length>0&&e<t.length&&(Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(t[e],$(".settings")[0]))}),10)}))):t.removeToken?(y(p,""),Lampa.Noty.show("Токен удалён"),a&&a(),Lampa.Controller.toggle(v),setTimeout((function(){var t=$(".lamponline-server-item.selector");t.length>0&&e<t.length&&(Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(t[e],$(".settings")[0]))}),10)):t.edit?(Lampa.Select.close(),Lampa.Input.edit({title:Lampa.Lang.translate("lampac_server_address"),value:i[e],placeholder:"192.168.1.1:9118",nosave:!0,free:!0,nomic:!0},(function(t){if(t&&t!==i[e]){var n=L(i[e]);n&&(y(i[e],""),y(t,n)),V(e,t),O()}a&&a(),Lampa.Controller.toggle(v),setTimeout((function(){var t=$(".lamponline-server-item.selector");t.length>0&&e<t.length&&(Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(t[e],$(".settings")[0]))}),10)}))):t.remove&&(y(i[e],""),m(e),a&&a(),Lampa.Controller.toggle(v),setTimeout((function(){var t=$(".lamponline-server-item.selector"),a=Math.min(e,t.length-1);if(t.length>0&&a>=0)Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(t[a],$(".settings")[0]);else{var n=$('[data-name="lamponline_add_server_btn"]');n.length&&(Lampa.Controller.collectionSet($(".settings")),Lampa.Controller.collectionFocus(n[0],$(".settings")[0]))}}),10))},onLong:function(n){n.edit&&(Lampa.Select.close(),J(e,t,a,!0))}})}function H(e){Lampa.Input.edit({title:Lampa.Lang.translate("lampac_server_address"),value:"",placeholder:"192.168.1.1:9118",nosave:!0,free:!0,nomic:!0},(function(t){t&&(c(t),s(r().length-1),O());e?e(t):t&&Lampa.Activity.replace()}))}function Q(e){var t=r(),a=l(),n=[];t.forEach((function(e,t){n.push({title:g(e),index:t,selected:t===a})})),n.push({title:Lampa.Lang.translate("lampac_add_server"),add:!0});var i=Lampa.Controller.enabled().name;Lampa.Select.show({title:Lampa.Lang.translate("lampac_select_server"),items:n,onBack:function(){Lampa.Controller.toggle(i)},onSelect:function(a){if(a.add)Lampa.Select.close(),H((function(t){e&&e(),Lampa.Controller.toggle(i),t&&Lampa.Activity.replace()}));else if(a.selected){var n=g(t[a.index]);Lampa.Select.show({title:n,items:[{title:Lampa.Lang.translate("lampac_edit_server"),edit:!0},{title:Lampa.Lang.translate("lampac_delete_server"),remove:!0}],onBack:function(){Q(e)},onSelect:function(n){n.edit?(Lampa.Select.close(),Lampa.Input.edit({title:Lampa.Lang.translate("lampac_server_address"),value:t[a.index],placeholder:"192.168.1.1:9118",nosave:!0,free:!0,nomic:!0},(function(n){n&&n!==t[a.index]&&(V(a.index,n),O()),e&&e(),Q(e)}))):n.remove&&(m(a.index),e&&e(),Q(e))}})}else s(a.index),O(),e&&e(),Lampa.Controller.toggle(i),Lampa.Activity.replace()}})}var Z="lamponline_public_servers_cache";function G(e,t){var a=[];function n(e){return e.replace(/^https?:\/\//,"").replace(/\/+$/,"").toLowerCase()}var i=r().map(n);a.push({title:Lampa.Lang.translate("lampac_refresh_servers"),refresh:!0}),a.push({title:Lampa.Lang.translate("lampac_public_servers"),separator:!0}),e.forEach((function(e){var t=n(e),o=-1!==i.indexOf(t);a.push({title:g(e),url:e,subtitle:o?Lampa.Lang.translate("lampac_server_already_added"):""})})),Lampa.Select.show({title:Lampa.Lang.translate("lampac_select_public_server")+" ("+e.length+")",items:a,onBack:function(){Lampa.Controller.toggle(t)},onSelect:function(e){if(!e.separator){if(e.refresh)return Lampa.Select.close(),void Y(t,!0);if(c(e.url)){s(r().length-1),O(),Lampa.Settings.update()}else{var a=r().indexOf(e.url);-1!==a&&(s(a),O(),Lampa.Settings.update())}Lampa.Controller.toggle(t)}}})}function Y(e,t){Lampa.Noty.show(Lampa.Lang.translate("lampac_loading"));var a=new Lampa.Reguest;a.timeout(1e4),a.silent("https://github.io/lampac-links/working_online_lampa.json",(function(t){if(Lampa.Arrays.isArray(t)&&0!==t.length){var a=[],i={};if(t.forEach((function(e){e.base_url&&(a.push(e.base_url),e.country&&(i[e.base_url]=e.country))})),0!==a.length){var o,r=[],l=0,s=a.length;c(),o=setInterval(c,2e3),a.forEach((function(t){!function(e,t){var a=e.replace(/\/+$/,""),n=a+"/lite/events?life=true&id=76600&imdb_id=tt1630029&kinopoisk_id=505898&serial=0&title=Avatar: The Way of Water&original_title=Avatar: The Way of Water&original_language=en&year=2022&source=tmdb&clarification=0&similar=false&rchtype=&uid=guest&device_id=",i=0,o="";function r(e){for(var t=0;t<e.length;t++){var a=e[t],n=(a.balanser||a.name||"").toLowerCase();if(-1!==n.indexOf("mirage")||-1!==n.indexOf("alloha"))return!0}return!1}!function e(){var l=new Lampa.Reguest;l.timeout(5e3);var s=o?a+"/lifeevents?memkey="+o+"&id=76600&imdb_id=tt1630029&kinopoisk_id=505898&serial=0&title=Avatar: The Way of Water&original_title=Avatar: The Way of Water&original_language=en&year=2022&source=tmdb&clarification=0&similar=false&rchtype=&uid=guest&device_id=":n;l.silent(s,(function(a){var n=a&&a.online?a.online:Lampa.Arrays.isArray(a)?a:[];a&&a.accsdb?t(!1):(a&&a.memkey&&(o=a.memkey),a&&a.ready||++i>=15?t(r(n)):setTimeout(e,1e3))}),(function(){t(!1)}))}()}(t,(function(a){if(l++,a&&(r.push(t),i[t]&&function(e,t){if(e&&t){var a=e.replace(/^https?:\/\//,"").replace(/\/+$/,"").toLowerCase(),i=p();i[a]=t,Lampa.Storage.set(n,i)}}(t,i[t])),c(),l===s){if(clearInterval(o),0===r.length)return void Lampa.Noty.show(Lampa.Lang.translate("lampac_no_working_servers"));m=r,Lampa.Storage.set(Z,m),G(r,e)}var m}))}))}else Lampa.Noty.show(Lampa.Lang.translate("lampac_no_servers_found"))}else Lampa.Noty.show(Lampa.Lang.translate("lampac_no_servers_found"));function c(){Lampa.Noty.show(Lampa.Lang.translate("lampac_checking_servers")+" "+l+"/"+s)}}),(function(e){console.error(e),Lampa.Noty.show(Lampa.Lang.translate("lampac_load_error"))}))}function X(){window.lamponline_src_filter_plugin||(window.lamponline_src_filter_plugin=!0,Lampa.Controller.listener.follow("toggle",(function(e){if("select"===e.name){var t=Lampa.Activity.active();if(t&&t.component&&"lamponline"===t.component.toLowerCase()){var a=$(".selectbox__title");if(1===a.length&&a.text()===Lampa.Lang.translate("title_filter")){var n=$(".simple-button--filter.filter--sort");if(!(1!==n.length||n.hasClass("hide")||$(".selectbox-item[data-lamponline-source]").length>0)){var i=$(".simple-button--filter.filter--server"),o=Lampa.Template.get("selectbox_item",{title:Lampa.Lang.translate("settings_rest_source"),subtitle:$("div",n).text()});if(o.attr("data-lamponline-source","true"),o.on("hover:enter",(function(){n.trigger("hover:enter")})),$(".selectbox-item").first().after(o),1===i.length&&!i.hasClass("hide")){var r=Lampa.Template.get("selectbox_item",{title:Lampa.Lang.translate("lampac_server_short"),subtitle:$("div",i).text()});r.attr("data-lamponline-server","true"),r.on("hover:enter",(function(){Lampa.Select.close(),i.trigger("hover:enter")})),$(".selectbox-item").first().after(r)}Lampa.Controller.collectionSet($("body > .selectbox").find(".scroll__body"))}}}}})))}window.lamponline_plugin||function(){window.lamponline_plugin=!0;var t,a,n,i,o={type:"video",version:"1.0.0",name:"",description:"Просмотр онлайна",component:"lamponline",onContextLauch:function(e){Lampa.Component.add("lamponline",W);var t=Lampa.Utils.hash(e.number_of_seasons?e.original_name:e.original_title),a=Lampa.Storage.get(S.StorageKeys.ClarificationSearch,"{}");Lampa.Activity.push({url:"",title:Lampa.Lang.translate("title_online"),component:"lamponline",search:a[t]?a[t]:e.title,search_one:e.title,search_two:e.original_title,movie:e,page:1,clarification:!!a[t]})}};t="Онлайн",a="spider",n=new Lampa.Reguest,i={title:t,search:function(e,t){function i(e){var i=Lampa.Arrays.getKeys(e);if(i.length){var o=new Lampa.Status(i.length);o.onComplite=function(e){var n=[];i.forEach((function(t){var i=e[t];if(i&&i.data&&"similar"==i.type){var o=i.data.map((function(e){return e.title=Lampa.Utils.capitalizeFirstLetter(e.title),e.release_date=e.year||"0000",e.balanser=a,void 0!==e.img&&("/"===e.img.charAt(0)&&(e.img=T.getLocalhost()+e.img.substring(1)),-1!==e.img.indexOf("/proxyimg")&&(e.img=F(e.img))),e}));n.push({title:t,results:o})}})),t(n)},i.forEach((function(t){n.silent(F(e[t]),(function(e){o.append(t,e)}),(function(){o.error()}))}))}else t([])}n.silent(F(T.getLocalhost()+"lite/"+a+"?title="+e.query),(function(o){o.rch?E(o,(function(){n.silent(F(T.getLocalhost()+"lite/"+a+"?title="+e.query),(function(e){i(e)}),(function(){t([])}))})):i(o)}),(function(){t([])}))},onCancel:function(){n.clear()},params:{lazy:!0,align_left:!0,card_events:{onMenu:function(){}}},onMore:function(e,t){t()},onSelect:function(e,t){t(),Lampa.Activity.push({url:e.element.url,title:"Lampac - "+e.element.title,component:"lamponline",movie:e.element,page:1,search:e.element.title,clarification:!0,balanser:e.element.balanser,noinfo:!0})}},Lampa.Search.addSource(i),Lampa.Manifest.plugins=o,Lampa.Lang.add({lampac_watch:{ru:"Смотреть онлайн",en:"Watch online",uk:"Дивитися онлайн",zh:"在线观看"},lampac_video:{ru:"Видео",en:"Video",uk:"Відео",zh:"视频"},lampac_no_watch_history:{ru:"Нет истории просмотра",en:"No browsing history",ua:"Немає історії перегляду",zh:"没有浏览历史"},lampac_nolink:{ru:"Не удалось извлечь ссылку",uk:"Неможливо отримати посилання",en:"Failed to fetch link",zh:"获取链接失败"},lampac_balanser:{ru:"Источник",uk:"Джерело",en:"Source",zh:"来源"},helper_online_file:{ru:'Удерживайте клавишу "ОК" для вызова контекстного меню',uk:'Утримуйте клавішу "ОК" для виклику контекстного меню',en:'Hold the "OK" key to bring up the context menu',zh:"按住“确定”键调出上下文菜单"},title_online:{ru:"Онлайн",uk:"Онлайн",en:"Online",zh:"在线的"},lampac_voice_subscribe:{ru:"Подписаться на перевод",uk:"Підписатися на переклад",en:"Subscribe to translation",zh:"订阅翻译"},lampac_voice_success:{ru:"Вы успешно подписались",uk:"Ви успішно підписалися",en:"You have successfully subscribed",zh:"您已成功订阅"},lampac_voice_error:{ru:"Возникла ошибка",uk:"Виникла помилка",en:"An error has occurred",zh:"发生了错误"},lampac_clear_all_marks:{ru:"Очистить все метки",uk:"Очистити всі мітки",en:"Clear all labels",zh:"清除所有标签"},lampac_clear_all_timecodes:{ru:"Очистить все тайм-коды",uk:"Очистити всі тайм-коди",en:"Clear all timecodes",zh:"清除所有时间代码"},lampac_change_balanser:{ru:"Изменить балансер",uk:"Змінити балансер",en:"Change balancer",zh:"更改平衡器"},lampac_balanser_dont_work:{ru:"Поиск не дал результатов",uk:"Пошук на ({balanser}) не дав результатів",en:"Search on ({balanser}) did not return any results",zh:"搜索 ({balanser}) 未返回任何结果"},lampac_balanser_timeout:{ru:'Источник будет переключен автоматически через <span class="timeout">10</span> секунд.',uk:'Джерело буде автоматично переключено через <span class="timeout">10</span> секунд.',en:'The source will be switched automatically after <span class="timeout">10</span> seconds.',zh:'平衡器将在<span class="timeout">10</span>秒内自动切换。'},lampac_does_not_answer_text:{ru:"Поиск не дал результатов",uk:"Пошук на ({balanser}) не дав результатів",en:"Search on ({balanser}) did not return any results",zh:"搜索 ({balanser}) 未返回任何结果"},lampac_server_not_set:{ru:"Сервер не настроен",uk:"Сервер не налаштований",en:"Server not configured",zh:"服务器未配置"},lampac_server_not_set_desc:{ru:"Укажите адрес сервера в настройках для просмотра онлайн",uk:"Вкажіть адресу сервера в налаштуваннях для перегляду онлайн",en:"Specify the server address in settings to watch online",zh:"在设置中指定服务器地址以在线观看"},lampac_open_settings:{ru:"Открыть настройки",uk:"Відкрити налаштування",en:"Open settings",zh:"打开设置"},lampac_enter_server:{ru:"Ввести адрес сервера",uk:"Ввести адресу сервера",en:"Enter server address",zh:"输入服务器地址"},lampac_server_short:{ru:"Сервер",uk:"Сервер",en:"Server",zh:"服务器"},lampac_not_set:{ru:"Не указан",uk:"Не вказано",en:"Not set",zh:"未设置"},lampac_add_server:{ru:"Добавить сервер",uk:"Додати сервер",en:"Add server",zh:"添加服务器"},lampac_select_server:{ru:"Выбор сервера",uk:"Вибір сервера",en:"Select server",zh:"选择服务器"},lampac_servers_list:{ru:"Список серверов",uk:"Список серверів",en:"Servers list",zh:"服务器列表"},lampac_select_this:{ru:"Выбрать",uk:"Вибрати",en:"Select",zh:"选择"},lampac_delete_server:{ru:"Удалить",uk:"Видалити",en:"Delete",zh:"删除"},lampac_edit_server:{ru:"Редактировать",uk:"Редагувати",en:"Edit",zh:"编辑"},lampac_server_address:{ru:"Адрес сервера",uk:"Адреса сервера",en:"Server address",zh:"服务器地址"},lampac_server_address_desc:{ru:"Например: 192.168.1.1:9118, lampac.site или bwa::код",uk:"Наприклад: 192.168.1.1:9118, lampac.site або bwa::код",en:"Example: 192.168.1.1:9118, lampac.site or bwa::code",zh:"例如：192.168.1.1:9118, lampac.site 或 bwa::code"},lampac_settings_title:{ru:"Онлайн",uk:"Онлайн",en:"Online",zh:"在线"},lampac_load_public_servers:{ru:"Загрузить открытые серверы",uk:"Завантажити відкриті сервери",en:"Load public servers",zh:"加载公共服务器"},lampac_load_public_servers_desc:{ru:"Загрузить список бесплатных серверов из интернета",uk:"Завантажити список безкоштовних серверів з інтернету",en:"Load list of free servers from internet",zh:"从互联网加载免费服务器列表"},lampac_loading:{ru:"Загрузка...",uk:"Завантаження...",en:"Loading...",zh:"加载中..."},lampac_load_error:{ru:"Ошибка загрузки серверов",uk:"Помилка завантаження серверів",en:"Error loading servers",zh:"加载服务器错误"},lampac_no_servers_found:{ru:"Серверы не найдены",uk:"Сервери не знайдено",en:"No servers found",zh:"未找到服务器"},lampac_checking_servers:{ru:"Проверка серверов",uk:"Перевірка серверів",en:"Checking servers",zh:"检查服务器"},lampac_no_working_servers:{ru:"Рабочие серверы не найдены",uk:"Робочі сервери не знайдено",en:"No working servers found",zh:"未找到可用服务器"},lampac_found_working:{ru:"Найдено рабочих",uk:"Знайдено робочих",en:"Found working",zh:"找到可用"},lampac_select_public_server:{ru:"Выберите сервер",uk:"Виберіть сервер",en:"Select server",zh:"选择服务器"},lampac_refresh_servers:{ru:"Обновить список",uk:"Оновити список",en:"Refresh list",zh:"刷新列表"},lampac_server_already_added:{ru:"Уже добавлен",uk:"Вже додано",en:"Already added",zh:"已添加"},lampac_public_servers:{ru:"Публичные серверы",uk:"Публічні сервери",en:"Public servers",zh:"公共服务器"}});var l='<div class="full-start__button selector view--online lampac--button" data-subtitle="'.concat(o.name,' ").concat(manifst.version, "">\n         <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.783 10.094c-1.699.998-3.766 1.684-5.678 1.95a1.66 1.66 0 0 1-.684.934c.512 1.093 1.249 2.087 2.139 2.987a7.98 7.98 0 0 0 6.702-3.074l.083-.119c-.244-.914-.648-1.784-1.145-2.644q-.134.038-.261.062c-.143.04-.291.068-.446.068a1.7 1.7 0 0 1-.71-.164M9.051 5.492a18 18 0 0 0-2.004-1.256 1.67 1.67 0 0 1-1.907.985c-.407 1.535-.624 3.162-.511 4.694a1.67 1.67 0 0 1 1.52 1.354c1.695-.279 3.47-.879 4.967-1.738a1.67 1.67 0 0 1-.297-.949c0-.413.156-.786.403-1.078-.654-.736-1.389-1.443-2.171-2.012M4 9.989c-.137-1.634.104-3.392.541-5.032a1.67 1.67 0 0 1-.713-1.369c0-.197.039-.386.104-.562a18 18 0 0 0-1.974-.247c-.089.104-.185.204-.269.314a7.98 7.98 0 0 0-1.23 7.547 9.5 9.5 0 0 0 2.397.666A1.67 1.67 0 0 1 4 9.989m9.928-.3c-.029.037-.064.067-.096.1.433.736.799 1.482 1.053 2.268a7.98 7.98 0 0 0 .832-6.122c-.09.133-.176.267-.271.396-.436.601-.875 1.217-1.354 1.772.045.152.076.311.076.479v.004c.084.374.013.779-.24 1.103M7.164 3.447c.799.414 1.584.898 2.33 1.44.84.611 1.627 1.373 2.324 2.164.207-.092.434-.145.676-.145.5 0 .945.225 1.252.572.404-.492.783-1.022 1.161-1.54.194-.268.372-.543.544-.82A7.96 7.96 0 0 0 7.701.012q-.173.217-.339.439c-.401.552-.739 1.08-1.04 1.637.039.029.064.066.1.1.417.276.697.734.742 1.259m-4.285 8.518a10 10 0 0 1-2.07-.487 7.95 7.95 0 0 0 5.806 4.397 11 11 0 0 1-1.753-2.66 1.675 1.675 0 0 1-1.983-1.25m1.635-9.723a1.32 1.32 0 0 1 1.199-.416C6.025 1.24 6.377.683 6.794.104a7.97 7.97 0 0 0-4.247 2.062c.59.066 1.176.14 1.761.252q.096-.095.206-.176" fill="currentColor"/>\n</svg>\n\n        <span>#{title_online}</span>\n    </div>');function m(e){if(!e.render.find(".lampac--button").length){var t=$(Lampa.Lang.translate(l));t.on("hover:enter",(function(){Lampa.Component.add("lamponline",W);var t=Lampa.Utils.hash(e.movie.number_of_seasons?e.movie.original_name:e.movie.original_title),a=Lampa.Storage.get(S.StorageKeys.ClarificationSearch,"{}");Lampa.Activity.push({url:"",title:Lampa.Lang.translate("title_online"),component:"lamponline",search:a[t]?a[t]:e.movie.title,search_one:e.movie.title,search_two:e.movie.original_title,movie:e.movie,page:1,clarification:!!a[t]})})),e.render.before(t)}}Lampa.Component.add("lamponline",W),Lampa.Listener.follow("full",(function(e){"complite"==e.type&&m({render:e.object.activity.render().find(".view--torrent"),movie:e.data.movie})}));try{"full"==Lampa.Activity.active().component&&m({render:Lampa.Activity.active().activity.render().find(".view--torrent"),movie:Lampa.Activity.active().card})}catch(e){console.error(e)}if(Lampa.Manifest.app_digital>=177){["filmix","filmixtv","fxapi","rezka","rhsprem","lumex","videodb","collaps","collaps-dash","hdvb","zetflix","kodik","ashdi","kinoukr","kinotochka","remux","iframevideo","cdnmovies","anilibria","animedia","animego","animevost","animebesst","redheadsound","alloha","animelib","moonanime","kinopub","vibix","vdbmovies","fancdn","cdnvideohub","vokino","rc/filmix","rc/fxapi","rc/rhs","vcdn","videocdn","mirage","hydraflix","videasy","vidsrc","movpi","vidlink","twoembed","autoembed","smashystream","autoembed","rgshows","pidtor","videoseed","iptvonline","veoveo"].forEach((function(e){Lampa.Storage.sync(S.StorageKeys.OnlineChoicePrefix+e,"object_object")})),Lampa.Storage.sync(S.StorageKeys.OnlineWatchedLast,"object_object")}Lampa.Settings.listener.follow("open",(function(e){"main"==e.name&&(0==Lampa.Settings.main().render().find('[data-component="lamponline_settings"]').length&&Lampa.SettingsApi.addComponent({component:"lamponline_settings",name:Lampa.Lang.translate("lampac_settings_title"),icon:'<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M11.783 10.094c-1.699.998-3.766 1.684-5.678 1.95a1.66 1.66 0 0 1-.684.934c.512 1.093 1.249 2.087 2.139 2.987a7.98 7.98 0 0 0 6.702-3.074l.083-.119c-.244-.914-.648-1.784-1.145-2.644q-.134.038-.261.062c-.143.04-.291.068-.446.068a1.7 1.7 0 0 1-.71-.164M9.051 5.492a18 18 0 0 0-2.004-1.256 1.67 1.67 0 0 1-1.907.985c-.407 1.535-.624 3.162-.511 4.694a1.67 1.67 0 0 1 1.52 1.354c1.695-.279 3.47-.879 4.967-1.738a1.67 1.67 0 0 1-.297-.949c0-.413.156-.786.403-1.078-.654-.736-1.389-1.443-2.171-2.012M4 9.989c-.137-1.634.104-3.392.541-5.032a1.67 1.67 0 0 1-.713-1.369c0-.197.039-.386.104-.562a18 18 0 0 0-1.974-.247c-.089.104-.185.204-.269.314a7.98 7.98 0 0 0-1.23 7.547 9.5 9.5 0 0 0 2.397.666A1.67 1.67 0 0 1 4 9.989m9.928-.3c-.029.037-.064.067-.096.1.433.736.799 1.482 1.053 2.268a7.98 7.98 0 0 0 .832-6.122c-.09.133-.176.267-.271.396-.436.601-.875 1.217-1.354 1.772.045.152.076.311.076.479v.004c.084.374.013.779-.24 1.103M7.164 3.447c.799.414 1.584.898 2.33 1.44.84.611 1.627 1.373 2.324 2.164.207-.092.434-.145.676-.145.5 0 .945.225 1.252.572.404-.492.783-1.022 1.161-1.54.194-.268.372-.543.544-.82A7.96 7.96 0 0 0 7.701.012q-.173.217-.339.439c-.401.552-.739 1.08-1.04 1.637.039.029.064.066.1.1.417.276.697.734.742 1.259m-4.285 8.518a10 10 0 0 1-2.07-.487 7.95 7.95 0 0 0 5.806 4.397 11 11 0 0 1-1.753-2.66 1.675 1.675 0 0 1-1.983-1.25m1.635-9.723a1.32 1.32 0 0 1 1.199-.416C6.025 1.24 6.377.683 6.794.104a7.97 7.97 0 0 0-4.247 2.062c.59.066 1.176.14 1.761.252q.096-.095.206-.176" fill="currentColor"/></svg>'}),Lampa.Settings.main().update())})),Lampa.Params.select(e,"",""),Lampa.SettingsApi.addParam({component:"lamponline_settings",param:{name:"lamponline_add_server_btn",type:"static"},field:{name:Lampa.Lang.translate("lampac_add_server"),description:Lampa.Lang.translate("lampac_server_address_desc")},onRender:function(e){e.on("hover:enter",(function(){Lampa.Input.edit({title:Lampa.Lang.translate("lampac_server_address"),value:"",placeholder:"192.168.1.1:9118 / bwa::code",nosave:!0,free:!0,nomic:!0},(function(e){e&&c(e)&&(s(r().length-1),h(e)?k((function(){})):O(),Lampa.Settings.update())}))}))}}),Lampa.SettingsApi.addParam({component:"lamponline_settings",param:{name:"lamponline_load_public_servers_btn",type:"static"},field:{name:Lampa.Lang.translate("lampac_load_public_servers"),description:Lampa.Lang.translate("lampac_load_public_servers_desc")},onRender:function(e){e.on("hover:enter",(function(){var e,t;e=Lampa.Controller.enabled().name,(t=function(){var e=Lampa.Storage.get(Z,[]);if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}return Lampa.Arrays.isArray(e)?e:[]}()).length>0?G(t,e):Y(e,!1)}))}}),Lampa.SettingsApi.addParam({component:"lamponline_settings",param:{name:"lamponline_servers_title",type:"title"},field:{name:Lampa.Lang.translate("lampac_servers_list")}}),Lampa.Settings.listener.follow("open",(function(e){"lamponline_settings"==e.name&&D(e.body)}))}(),window.appready?(X(),f()&&v()&&k((function(){}))):Lampa.Listener.follow("app",(function(e){"ready"===e.type&&(X(),f()&&v()&&k((function(){})))}))}();